# 🔧 後端服務連接問題 - 故障排除

## ❌ 錯誤信息
```
⚠️ 無法連接到後端服務進行測試
```

## 🔍 問題診斷

### 步驟1：檢查後端服務是否運行

打開新的終端窗口，運行：
```bash
netstat -ano | findstr :5000
```

**如果沒有輸出**：後端服務未運行，需要啟動
**如果有輸出**：後端服務正在運行，可能是其他問題

### 步驟2：啟動後端服務

#### 方法一：使用啟動腳本（推薦）

**雙擊運行：`啟動后端服务.bat`**

#### 方法二：手動啟動

打開終端，運行：
```bash
python app.py
```

應該看到類似輸出：
```
 * Running on http://127.0.0.1:5000
```

### 步驟3：檢查常見問題

#### 問題1：端口被占用

**錯誤信息**：
```
OSError: [WinError 10048] 通常每個套接字地址(協議/網絡地址/端口)只允許使用一次
```

**解決方案**：
1. 找到占用5000端口的進程：
   ```bash
   netstat -ano | findstr :5000
   ```
2. 記下PID（最後一列數字）
3. 結束進程：
   ```bash
   taskkill /PID <PID號碼> /F
   ```
4. 重新啟動後端服務

#### 問題2：依賴包未安裝

**錯誤信息**：
```
ModuleNotFoundError: No module named 'flask'
```

**解決方案**：
```bash
pip install flask flask-cors python-dotenv zai
```

#### 問題3：API密鑰未配置

**警告信息**：
```
警告：请设置您的智谱AI API密钥！
```

**解決方案**：
1. 打開 `config.py` 文件
2. 設置API密鑰（可選，不設置也能啟動服務，只是AI功能不可用）

#### 問題4：防火牆阻止

**解決方案**：
- Windows防火牆可能會阻止本地連接
- 允許Python通過防火牆，或暫時關閉防火牆測試

### 步驟4：驗證服務運行

在瀏覽器中訪問：
```
http://localhost:5000/health
```

應該看到：
```json
{
  "status": "ok",
  "service": "DSE SQL 訓練營 AI服务"
}
```

## ✅ 快速修復步驟

### 完整啟動流程

1. **終端1 - 啟動後端**：
   ```bash
   python app.py
   ```
   等待看到：`Running on http://127.0.0.1:5000`

2. **終端2 - 啟動前端**（如果還沒啟動）：
   ```bash
   python -m http.server 8000
   ```

3. **訪問網頁**：
   ```
   http://localhost:8000/index.html
   ```

## 🎯 測試連接

在瀏覽器控制台（F12）運行：
```javascript
fetch('http://localhost:5000/health')
  .then(r => r.json())
  .then(data => console.log('後端服務正常:', data))
  .catch(err => console.error('連接失敗:', err));
```

## 📋 檢查清單

- [ ] Python已安裝（`python --version`）
- [ ] 依賴包已安裝（`pip list | findstr flask`）
- [ ] 後端服務正在運行（`netstat -ano | findstr :5000`）
- [ ] 端口5000未被占用
- [ ] 瀏覽器可以訪問 `http://localhost:5000/health`
- [ ] 沒有防火牆阻止

## 🔄 重新啟動服務

如果服務異常，按以下步驟重新啟動：

1. **停止當前服務**：
   - 在運行 `python app.py` 的終端按 `Ctrl+C`

2. **清理端口**（如果端口被占用）：
   ```bash
   netstat -ano | findstr :5000
   taskkill /PID <PID> /F
   ```

3. **重新啟動**：
   ```bash
   python app.py
   ```

## 💡 提示

- **後端服務必須運行**：AI功能（學習分析、檢錯教官）需要後端服務
- **基礎功能可用**：即使後端未運行，所有基礎學習功能都可以正常使用
- **檢查終端輸出**：後端服務的終端會顯示所有請求日誌，有助於診斷問題

## 🆘 仍然無法連接？

1. 檢查 `app.py` 文件是否存在
2. 檢查 `config.py` 文件是否存在
3. 查看後端服務終端的錯誤信息
4. 檢查瀏覽器控制台的完整錯誤信息
5. 嘗試使用不同的端口（修改 `app.py` 中的端口號）

