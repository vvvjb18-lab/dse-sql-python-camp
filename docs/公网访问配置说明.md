# 🌐 公网访问配置说明

## 📋 配置概述

当您通过公网IP `http://59.148.148.76/` 访问时，系统会自动检测主机地址并连接到正确的后端服务。

## 🔧 服务端口配置

### 前端服务
- **默认端口**：80（HTTP）或 8000（开发环境）
- **访问地址**：`http://59.148.148.76/` 或 `http://59.148.148.76:8000/`

### 后端服务（AI功能）
- **固定端口**：5000
- **访问地址**：`http://59.148.148.76:5000`
- **健康检查**：`http://59.148.148.76:5000/health`

## ✅ 自动检测机制

系统已配置自动检测功能：
- **本地访问**（localhost）：自动连接到 `http://localhost:5000/api`
- **公网访问**（59.148.148.76）：自动连接到 `http://59.148.148.76:5000/api`

无需手动配置，系统会根据当前访问地址自动调整。

## 🚀 启动步骤

### 1. 启动后端服务

```bash
python app.py
```

后端服务将运行在 `0.0.0.0:5000`，可以接受来自任何IP地址的连接。

**验证后端服务**：
- 访问：`http://59.148.148.76:5000/health`
- 应该看到：`{"status": "ok", "service": "DSE SQL 訓練營 AI服务"}`

### 2. 启动前端服务

**方式一：使用80端口（推荐，无需端口号）**
```bash
# 需要管理员权限
python -m http.server 80
```

**方式二：使用8000端口**
```bash
python -m http.server 8000
```
访问地址：`http://59.148.148.76:8000/`

### 3. 访问网页

在浏览器中打开：
- `http://59.148.148.76/`（如果前端在80端口）
- 或 `http://59.148.148.76:8000/`（如果前端在8000端口）

## 🔒 防火墙配置

### Windows防火墙

1. 打开"Windows Defender 防火墙"
2. 点击"高级设置"
3. 选择"入站规则" → "新建规则"
4. 选择"端口" → "TCP" → 输入端口号 `5000`
5. 允许连接
6. 重复上述步骤，为端口 `80` 或 `8000` 创建规则

### 路由器/网络配置

如果需要从外网访问，需要配置端口转发：
- **前端端口**：80 或 8000 → 转发到内网服务器
- **后端端口**：5000 → 转发到内网服务器

## 🧪 测试连接

### 测试后端服务

在浏览器中访问：
```
http://59.148.148.76:5000/health
```

应该返回：
```json
{
  "status": "ok",
  "service": "DSE SQL 訓練營 AI服务"
}
```

### 测试前端页面

在浏览器中访问：
```
http://59.148.148.76/
```

或

```
http://59.148.148.76:8000/
```

### 测试AI功能

1. 打开互动练习页面
2. 点击"🤖 AI助手"按钮
3. 如果显示"AI服務已連接"，说明配置成功
4. 如果显示"⚠️ AI服務未連接"，请检查：
   - 后端服务是否运行
   - 5000端口是否可访问
   - 防火墙是否允许连接

## ⚠️ 常见问题

### Q1: 无法访问后端服务（5000端口）

**可能原因**：
- 防火墙阻止了5000端口
- 后端服务未启动
- 端口被占用

**解决方案**：
1. 检查后端服务是否运行：`netstat -ano | findstr :5000`
2. 检查防火墙设置
3. 确认后端服务监听在 `0.0.0.0:5000`（不是 `127.0.0.1:5000`）

### Q2: 前端可以访问，但AI功能不可用

**可能原因**：
- 后端服务未运行
- 5000端口被防火墙阻止
- 浏览器跨域问题

**解决方案**：
1. 确认后端服务正在运行
2. 访问 `http://59.148.148.76:5000/health` 测试连接
3. 检查浏览器控制台是否有错误信息

### Q3: 使用80端口需要管理员权限

**解决方案**：
- 使用8000端口（不需要管理员权限）
- 或配置反向代理（如Nginx）将80端口转发到8000端口

## 📝 配置检查清单

- [ ] 后端服务运行在 `0.0.0.0:5000`
- [ ] 前端服务运行在80或8000端口
- [ ] 防火墙允许5000端口（后端）
- [ ] 防火墙允许80或8000端口（前端）
- [ ] 可以访问 `http://59.148.148.76:5000/health`
- [ ] 可以访问前端页面
- [ ] AI功能正常工作

## 💡 提示

1. **开发环境**：建议使用8000端口，避免需要管理员权限
2. **生产环境**：使用80端口（HTTP）或443端口（HTTPS），需要配置反向代理
3. **安全建议**：如果只在内网使用，可以限制防火墙规则，只允许特定IP访问
4. **端口冲突**：如果5000端口被占用，可以修改 `app.py` 中的端口号，同时更新 `ai-service.js` 和 `admin.html` 中的端口配置

