# GUI 服務管理器 - 功能更新說明

## 🎉 新增功能

### 1. 網域名稱配置功能

**位置：** 左側控制面板 → 「網域名稱配置」

**功能：**
- 可以輸入和保存公網 IP 地址或域名
- 支持 IP 地址格式（如：59.148.148.76）
- 支持域名格式（如：example.com）
- 配置會自動保存到 `domain_config.json` 文件
- 保存後會自動更新快速訪問鏈接

**使用方法：**
1. 在「公網 IP/域名」輸入框中輸入您的公網 IP 或域名
2. 點擊「💾 保存網域名稱」按鈕
3. 系統會驗證格式並保存配置

**配置文件位置：** `domain_config.json`

**配置格式：**
```json
{
  "public_ip": "59.148.148.76",
  "domain_name": "",
  "display_value": "59.148.148.76",
  "last_updated": "2025-12-17 12:00:00"
}
```

### 2. 公網訪問診斷功能

**位置：** 
- 左側控制面板 → 「公網訪問」→ 「🔍 診斷公網訪問」
- 右側標籤頁 → 「公網訪問診斷」

**功能：**
- 自動檢查服務運行狀態
- 檢查端口監聽狀態
- 測試本地連接
- 測試內網連接
- 檢查防火牆狀態
- 提供端口映射配置建議
- 嘗試測試公網連接

**診斷項目：**
1. ✅ 服務狀態檢查
2. ✅ 端口監聽檢查（確認是否監聽在 0.0.0.0）
3. ✅ 本地連接測試
4. ✅ 內網連接測試
5. ✅ 防火牆狀態檢查
6. ✅ 端口映射配置建議

**使用方法：**
1. 點擊「🔍 診斷公網訪問」按鈕
2. 查看診斷結果（顯示在「公網訪問診斷」標籤頁）
3. 根據診斷結果進行相應配置

### 3. 防火牆配置功能

**位置：** 左側控制面板 → 「公網訪問」→ 「🔧 配置防火牆」

**功能：**
- 自動檢測防火牆類型（UFW、firewalld）
- 生成防火牆配置腳本
- 提供手動配置指南

**使用方法：**
1. 點擊「🔧 配置防火牆」按鈕
2. 確認操作（需要 sudo 權限）
3. 按照提示運行配置命令

**支持的防火牆：**
- UFW（Ubuntu/Debian）
- firewalld（Fedora/RHEL）
- iptables（通用）

### 4. 快速訪問模式切換

**位置：** 左側控制面板 → 「快速訪問」

**功能：**
- 支持「本地」和「公網」兩種訪問模式
- 本地模式：使用 `http://localhost:5000`
- 公網模式：使用配置的網域名稱或 IP
- 切換模式後，所有快速訪問按鈕會自動更新

**使用方法：**
1. 選擇「本地」或「公網」單選按鈕
2. 快速訪問按鈕會自動更新為對應的 URL

## 📋 使用流程

### 配置公網訪問的完整流程

1. **配置網域名稱**
   - 在「網域名稱配置」中輸入公網 IP 或域名
   - 點擊「保存網域名稱」

2. **啟動服務**
   - 點擊「▶ 啟動服務」
   - 等待服務啟動完成

3. **診斷公網訪問**
   - 點擊「🔍 診斷公網訪問」
   - 查看診斷結果

4. **配置防火牆**
   - 如果診斷顯示防火牆問題，點擊「🔧 配置防火牆」
   - 按照提示配置防火牆

5. **測試訪問**
   - 切換到「公網」模式
   - 點擊快速訪問按鈕測試連接

## 🔧 技術細節

### 網域名稱驗證

- **IP 地址驗證：** 使用 `socket.inet_aton()` 驗證
- **域名驗證：** 使用正則表達式驗證格式
- **自動解析：** 如果輸入域名，會嘗試解析為 IP 地址

### 診斷功能

- **異步測試：** 公網連接測試在後台線程進行，不會阻塞界面
- **顏色標記：** 
  - 綠色：成功
  - 紅色：錯誤
  - 橙色：警告
- **實時更新：** 診斷結果實時顯示

### 防火牆檢測

- 自動檢測系統安裝的防火牆類型
- 支持多種防火牆配置方式
- 提供友好的錯誤提示

## 📝 配置文件

### domain_config.json

網域名稱配置保存在 `domain_config.json` 文件中：

```json
{
  "public_ip": "59.148.148.76",
  "domain_name": "",
  "display_value": "59.148.148.76",
  "last_updated": "2025-12-17 12:00:00"
}
```

**字段說明：**
- `public_ip`: 公網 IP 地址
- `domain_name`: 域名（如果使用域名）
- `display_value`: 顯示值（IP 或域名）
- `last_updated`: 最後更新時間

## ⚠️ 注意事項

1. **防火牆配置需要 sudo 權限**
   - 配置防火牆時需要管理員權限
   - 程序會提示您運行相應的命令

2. **網域名稱格式**
   - IP 地址：必須是有效的 IPv4 地址
   - 域名：必須是有效的域名格式

3. **公網連接測試**
   - 公網連接測試需要從外部網絡訪問
   - 如果測試失敗，可能是防火牆或端口映射問題

4. **配置保存**
   - 網域名稱配置會自動保存
   - 保存後會立即更新快速訪問鏈接

## 🐛 故障排除

### 問題：無法保存網域名稱

**解決方案：**
- 檢查輸入格式是否正確
- 確認有寫入權限
- 查看日誌區域的錯誤信息

### 問題：診斷結果不準確

**解決方案：**
- 確保服務正在運行
- 檢查網絡連接
- 重新運行診斷

### 問題：防火牆配置失敗

**解決方案：**
- 確認有 sudo 權限
- 手動運行配置命令
- 查看系統日誌

## 📚 相關文檔

- `服務管理器使用說明.md` - 完整使用說明
- `GUI服務管理器快速指南.md` - 快速啟動指南
- `公網訪問故障排除.md` - 公網訪問故障排除

---

**更新日期：** 2025-12-17

