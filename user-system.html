<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ¶ä¸­å¿ƒ - DSE SQL è¨“ç·´ç‡Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="lang.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif; }
        .glass-card {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 1rem;
            border: 1px solid rgba(148, 163, 184, 0.3);
            box-shadow: 0 18px 45px rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(18px);
        }
        .input-base {
            @apply w-full px-3 py-2 rounded-lg border border-slate-300 bg-white text-gray-900 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500;
            color: #111827 !important;
        }
        .input-base::placeholder {
            color: #9ca3af;
        }
        .input-base::-webkit-input-placeholder {
            color: #9ca3af;
        }
        .input-base::-moz-placeholder {
            color: #9ca3af;
        }
        .input-base:-ms-input-placeholder {
            color: #9ca3af;
        }
        .btn-primary {
            @apply inline-flex items-center justify-center px-4 py-2 rounded-lg text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-sky-500 hover:from-blue-500 hover:to-sky-400 shadow-lg shadow-blue-500/25 transition;
        }
        .btn-secondary {
            @apply inline-flex items-center justify-center px-4 py-2 rounded-lg text-sm font-medium text-slate-100 bg-slate-700/70 hover:bg-slate-600/90 border border-slate-500/60 transition;
        }
        .badge {
            @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium;
        }
        .badge-green {
            @apply badge bg-emerald-500/15 text-emerald-300 border border-emerald-500/40;
        }
        .badge-blue {
            @apply badge bg-sky-500/15 text-sky-300 border border-sky-500/40;
        }
        .badge-amber {
            @apply badge bg-amber-500/15 text-amber-300 border border-amber-500/40;
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">
    <!-- å°èˆªæ¬„ -->
    <nav class="bg-slate-950/80 border-b border-slate-800 sticky top-0 z-40 backdrop-blur">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 rounded-xl bg-gradient-to-br from-sky-500 to-blue-600 flex items-center justify-center shadow-lg shadow-sky-500/40">
                        <span class="text-white font-bold text-lg">SQL</span>
                    </div>
                    <div>
                        <div class="text-sm font-semibold text-slate-100">DSE SQL è¨“ç·´ç‡Ÿ</div>
                        <div class="text-xs text-slate-400">ç”¨æˆ¶ä¸­å¿ƒ Â· ç™»å…¥èˆ‡å€‹äººè³‡æ–™</div>
                    </div>
                </div>
                <div class="flex items-center space-x-6 text-sm">
                    <a href="index.html" class="text-slate-300 hover:text-sky-400" data-i18n-key="nav.home">è¨“ç·´å¹³å°</a>
                    <a href="guide.html" class="text-slate-300 hover:text-sky-400" data-i18n-key="nav.guide">å­¸ç¿’æŒ‡å—</a>
                    <a href="practice.html" class="text-slate-300 hover:text-sky-400" data-i18n-key="nav.practice">é¡Œåº«ç·´ç¿’</a>
                    <a href="progress.html" class="text-slate-300 hover:text-sky-400" data-i18n-key="nav.progress">å­¸ç¿’é€²åº¦</a>
                    <a href="interactive.html" class="text-slate-300 hover:text-sky-400" data-i18n-key="nav.interactive">äº’å‹•ç·´ç¿’</a>
                    <a href="user-system.html" class="text-sky-400 border-b border-sky-500 pb-1" data-i18n-key="nav.user">ç”¨æˆ¶ä¸­å¿ƒ</a>
                    <div class="hidden md:flex items-center space-x-2 text-[11px] text-slate-300 ml-4">
                        <span data-i18n-key="lang.label">èªè¨€</span>
                        <select id="lang-switcher" class="bg-slate-900/70 border border-slate-600 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-sky-500">
                            <option value="zh-Hant" data-i18n-key="lang.zhTW">ç¹é«”</option>
                            <option value="zh-Hans" data-i18n-key="lang.zhCN">ç°¡é«”</option>
                            <option value="en" data-i18n-key="lang.en">English</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»å…§å®¹ -->
    <main class="py-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- æ¨™é¡Œå€ -->
            <div class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold tracking-tight text-slate-50 mb-2">
                            <span data-i18n-key="user.title">ç”¨æˆ¶ä¸­å¿ƒ</span>
                            <span class="ml-2 text-base font-normal text-sky-400" data-i18n-key="user.subtitle">Sign in Â· Profile Â· Progress</span>
                        </h1>
                        <p class="text-sm text-slate-400" data-i18n-key="user.description">
                            åœ¨é€™è£¡ç®¡ç†ä½ çš„ç™»å…¥å¸³è™Ÿã€å€‹äººè³‡æ–™ï¼Œä¸¦æŸ¥çœ‹èˆ‡åŒæ­¥å­¸ç¿’é€²åº¦ã€‚
                        </p>
                    </div>
                    <div class="hidden md:flex items-center space-x-2 text-xs text-slate-400">
                        <span class="badge badge-green" data-i18n-key="user.badge.sqlite">SQLite æŒä¹…åŒ–</span>
                        <span class="badge badge-blue" data-i18n-key="user.badge.ai">AI å­¸ç¿’åŠ©æ‰‹å·²å•Ÿç”¨</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
                <!-- ç™»å…¥ / è¨»å†Š -->
                <div id="auth-section" class="space-y-6 lg:col-span-1">
                    <!-- ç™»å…¥å¡ç‰‡ -->
                    <section id="login-card" class="glass-card p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-lg font-semibold text-slate-50 flex items-center">
                                <span class="w-6 h-6 rounded-full bg-sky-500/20 text-sky-400 flex items-center justify-center text-sm mr-2">1</span>
                                <span data-i18n-key="login.title">ç™»å…¥</span>
                            </h2>
                            <span class="badge badge-blue" data-i18n-key="login.badgeExisting">ç¾æœ‰å¸³è™Ÿ</span>
                        </div>
                        <form id="login-form" class="space-y-4" onsubmit="handleLogin(event)">
                            <div>
                                <label for="login-username" class="block text-xs font-medium text-slate-300 mb-1" data-i18n-key="login.username">ç”¨æˆ¶å / é›»éƒµ</label>
                                <input id="login-username" type="text" class="input-base" placeholder="è¼¸å…¥ç”¨æˆ¶åæˆ–é›»å­éƒµä»¶" data-i18n-key="login.username.placeholder">
                        </div>
                        <div>
                                <label for="login-password" class="block text-xs font-medium text-slate-300 mb-1" data-i18n-key="login.password">å¯†ç¢¼</label>
                                <input id="login-password" type="password" class="input-base" placeholder="è¼¸å…¥å¯†ç¢¼" data-i18n-key="login.password.placeholder">
                            </div>
                            <div class="flex items-center justify-between text-xs text-slate-400">
                                <label class="inline-flex items-center space-x-2">
                                    <input id="remember-me" type="checkbox" class="rounded border-slate-600 bg-slate-900 text-sky-500 focus:ring-sky-500">
                                    <span data-i18n-key="login.remember">åœ¨æ­¤è£ç½®è¨˜ä½ç™»å…¥ç‹€æ…‹</span>
                                </label>
                                <button type="button" class="text-sky-400 hover:text-sky-300" data-i18n-key="login.forgot">å¿˜è¨˜å¯†ç¢¼ï¼Ÿ</button>
                        </div>
                            <button type="submit" class="btn-primary w-full">
                                <span class="mr-1" data-i18n-key="login.submit">ç™»å…¥</span>
                                <span>â†’</span>
                            </button>
                        </form>
                    </section>

                    <!-- è¨»å†Šå¡ç‰‡ -->
                    <section id="register-card" class="glass-card p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-lg font-semibold text-slate-50 flex items-center">
                                <span class="w-6 h-6 rounded-full bg-emerald-500/20 text-emerald-300 flex items-center justify-center text-sm mr-2">2</span>
                                <span data-i18n-key="register.title">è¨»å†Š</span>
                            </h2>
                            <span class="badge badge-amber" data-i18n-key="register.badgeNew">æ–°å¸³è™Ÿ</span>
                        </div>
                        <form id="register-form" class="space-y-4" onsubmit="handleRegister(event)">
                            <div>
                                <label for="register-username" class="block text-xs font-medium text-slate-300 mb-1" data-i18n-key="register.username">ç”¨æˆ¶å</label>
                                <input id="register-username" type="text" class="input-base" placeholder="ä¾‹å¦‚ï¼šsql_student01" data-i18n-key="register.username.placeholder">
                            </div>
                            <div>
                                <label for="register-email" class="block text-xs font-medium text-slate-300 mb-1" data-i18n-key="register.email">é›»å­éƒµä»¶</label>
                                <input id="register-email" type="email" class="input-base" placeholder="ä¾‹å¦‚ï¼šstudent@example.com" data-i18n-key="register.email.placeholder">
                            </div>
                            <div>
                                <label for="register-password" class="block text-xs font-medium text-slate-300 mb-1" data-i18n-key="register.password">å¯†ç¢¼</label>
                                <input id="register-password" type="password" class="input-base" placeholder="è‡³å°‘ 6 å€‹å­—ç¬¦" data-i18n-key="register.password.placeholder">
                            </div>
                            <div>
                                <label for="register-confirm-password" class="block text-xs font-medium text-slate-300 mb-1" data-i18n-key="register.confirmPassword">ç¢ºèªå¯†ç¢¼</label>
                                <input id="register-confirm-password" type="password" class="input-base" placeholder="å†æ¬¡è¼¸å…¥å¯†ç¢¼" data-i18n-key="register.confirmPassword.placeholder">
                            </div>
                            <p class="text-[11px] text-slate-400">
                                <span data-i18n-key="register.tosText">æäº¤å³è¡¨ç¤ºä½ åŒæ„æˆ‘å€‘çš„</span>
                                <a href="https://github.com/vvvjb18-lab/dse-sql-python-camp/blob/main/docs/terms.md" target="_blank" class="text-sky-400 hover:text-sky-300 underline" data-i18n-key="register.tosLink">ä½¿ç”¨æ¢æ¬¾</a>
                                <span> </span>
                                <span>å’Œ</span>
                                <span> </span>
                                <a href="https://github.com/vvvjb18-lab/dse-sql-python-camp/blob/main/docs/privacy.md" target="_blank" class="text-sky-400 hover:text-sky-300 underline" data-i18n-key="register.privacyLink">éš±ç§æ”¿ç­–</a>ã€‚
                            </p>
                            <button type="submit" class="btn-secondary w-full">
                                <span class="mr-1" data-i18n-key="register.submit">å»ºç«‹æ–°å¸³è™Ÿ</span>
                            </button>
                        </form>
                    </section>
                </div>

                <!-- å€‹äººè³‡æ–™ / å­¸ç¿’æ¦‚è¦½ -->
                <div id="profile-section" class="lg:col-span-2 space-y-6">
                    <!-- æœªç™»å…¥æç¤º -->
                    <section id="not-logged-in-view" class="glass-card p-8 hidden">
                        <div class="flex items-center space-x-4">
                            <div class="w-16 h-16 rounded-2xl bg-slate-900 flex items-center justify-center border border-slate-700">
                                <span class="text-3xl">ğŸ‘¤</span>
                            </div>
                            <div>
                                <h2 class="text-xl font-semibold text-slate-50 mb-1" data-i18n-key="notLoggedIn.title">å°šæœªç™»å…¥</h2>
                                <p class="text-sm text-slate-400" data-i18n-key="notLoggedIn.desc">
                                    ç™»å…¥å¾Œå¯ä»¥åŒæ­¥å­¸ç¿’é€²åº¦ã€ä¿å­˜é¡Œç›®å®Œæˆæƒ…æ³ï¼Œä¸¦åœ¨ä¸åŒè£ç½®ä¹‹é–“å»¶çºŒå­¸ç¿’ã€‚
                                </p>
                            </div>
                        </div>
                    </section>

                    <!-- å·²ç™»å…¥è¦–åœ– -->
                    <section id="logged-in-view" class="space-y-6 hidden">
                        <!-- é ‚éƒ¨ï¼šåŸºæœ¬è³‡æ–™ + å¿«é€Ÿå‹•ä½œ -->
                        <div class="glass-card p-6 flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
                            <div class="flex items-center space-x-4">
                                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-sky-500 to-blue-600 flex items-center justify-center text-2xl">
                                    <span id="profile-avatar-initial" class="text-white font-semibold">U</span>
                                </div>
                                <div>
                                    <div class="flex items-center space-x-2 mb-1">
                                        <h2 id="profile-username" class="text-xl font-semibold text-slate-50">ç”¨æˆ¶åç¨±</h2>
                                        <span class="badge badge-green" id="profile-level-badge">Lv.1</span>
                    </div>
                                    <p id="profile-email" class="text-xs text-slate-400">email@example.com</p>
                                    <p id="profile-join-date" class="text-[11px] text-slate-500 mt-1">åŠ å…¥æ—¥æœŸï¼š--</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <button type="button" class="btn-secondary text-xs" onclick="syncProgress()">
                                    ğŸ”„ <span data-i18n-key="profile.syncButton">åŒæ­¥å­¸ç¿’é€²åº¦</span>
                                </button>
                                <button type="button" class="btn-primary text-xs" onclick="handleLogout()">
                                    <span data-i18n-key="profile.logoutButton">ç™»å‡º</span>
                                </button>
                        </div>
                    </div>

                        <!-- ä¸­éƒ¨ï¼šå­¸ç¿’æ•¸æ“šæ¦‚è¦½ -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="glass-card p-4">
                                <div class="text-xs text-slate-400 mb-1" data-i18n-key="profile.stats.completed">å·²å®Œæˆé¡Œç›®</div>
                                <div id="profile-completed" class="text-2xl font-semibold text-sky-400">0</div>
                                <div class="mt-2 h-1.5 rounded-full bg-slate-800 overflow-hidden">
                                    <div id="profile-progress-bar" class="h-1.5 bg-gradient-to-r from-sky-500 to-emerald-400 w-0"></div>
                                </div>
                            </div>
                            <div class="glass-card p-4">
                                <div class="text-xs text-slate-400 mb-1" data-i18n-key="profile.stats.studyTime">ç´¯è¨ˆå­¸ç¿’æ™‚é–“</div>
                                <div id="profile-study-time" class="text-2xl font-semibold text-emerald-400">0 åˆ†é˜</div>
                                <div class="text-[11px] text-slate-500 mt-1" id="profile-study-hours">ç´„ 0.0 å°æ™‚</div>
                            </div>
                            <div class="glass-card p-4">
                                <div class="text-xs text-slate-400 mb-1" data-i18n-key="profile.stats.totalScore">ç¸½ç©åˆ†</div>
                                <div id="profile-total-score" class="text-2xl font-semibold text-amber-300">0</div>
                                <div class="text-[11px] text-slate-500 mt-1" id="profile-badge-info" data-i18n-key="profile.stats.badgeInfo">å®Œæˆæ›´å¤šé¡Œç›®ä»¥è§£é–æˆå°±</div>
                    </div>
                </div>

                        <!-- ä¸‹éƒ¨ï¼šå¯ç·¨è¼¯å€‹äººè³‡æ–™ -->
                        <section class="glass-card p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-slate-50" data-i18n-key="profile.sectionTitle">å€‹äººè³‡æ–™</h3>
                                <span class="text-[11px] text-slate-500" data-i18n-key="profile.sectionHint">é€™äº›è³‡è¨Šåªæœƒåœ¨æœ¬è¨“ç·´ç‡Ÿå…§ä½¿ç”¨</span>
                    </div>
                            <form id="profile-form" class="grid grid-cols-1 md:grid-cols-2 gap-4" onsubmit="handleProfileUpdate(event)">
                                <div>
                                    <label class="block text-xs font-medium text-slate-300 mb-1" data-i18n-key="profile.displayName">é¡¯ç¤ºåç¨±</label>
                                    <input id="profile-full-name" type="text" class="input-base" placeholder="æƒ³è®“åŒå­¸çœ‹åˆ°çš„åç¨±" data-i18n-key="profile.displayName.placeholder">
                    </div>
                                <div>
                                    <label class="block text-xs font-medium text-slate-300 mb-1" data-i18n-key="profile.location">æ‰€åœ¨åœ°</label>
                                    <input id="profile-location" type="text" class="input-base" placeholder="ä¾‹å¦‚ï¼šé¦™æ¸¯ / ä¹é¾ / æ–°ç•Œ" data-i18n-key="profile.location.placeholder">
                </div>
                        <div>
                                    <label class="block text-xs font-medium text-slate-300 mb-1" data-i18n-key="profile.phone">è¯çµ¡é›»è©±ï¼ˆé¸å¡«ï¼‰</label>
                                    <input id="profile-phone" type="text" class="input-base" placeholder="åªä½œé€šçŸ¥ç”¨é€”ï¼Œä¸æœƒå…¬é–‹" data-i18n-key="profile.phone.placeholder">
                        </div>
                        <div>
                                    <label class="block text-xs font-medium text-slate-300 mb-1" data-i18n-key="profile.birth">ç”Ÿæ—¥ï¼ˆé¸å¡«ï¼‰</label>
                                    <input id="profile-birth-date" type="date" class="input-base">
                        </div>
                                <div class="md:col-span-2">
                                    <label class="block text-xs font-medium text-slate-300 mb-1" data-i18n-key="profile.bio">å€‹äººç°¡ä»‹</label>
                                    <textarea id="profile-bio" rows="3" class="input-base" placeholder="ç°¡å–®ä»‹ç´¹è‡ªå·±ï¼Œä¾‹å¦‚å° SQL / Python çš„èˆˆè¶£æˆ–ç›®æ¨™ã€‚" data-i18n-key="profile.bio.placeholder"></textarea>
                    </div>
                                <div class="md:col-span-2 flex items-center justify-between mt-2">
                                    <div class="text-[11px] text-slate-500" data-i18n-key="profile.tip">
                                        å°æç¤ºï¼šä½ å¯ä»¥åœ¨ä»»æ„é é¢å³ä¸‹è§’é»æ“Š ğŸ¤–ï¼Œè«‹ AI å¹«ä½ è¦åŠƒå°ˆå±¬ SQL å­¸ç¿’è·¯ç·šã€‚
                    </div>
                                    <button type="submit" class="btn-primary text-xs">
                                        <span data-i18n-key="profile.save">å„²å­˜å€‹äººè³‡æ–™</span>
                    </button>
                </div>
            </form>
                        </section>
                        
                        <!-- AI æ¨¡å‹é¸æ“‡è¨­ç½® -->
                        <section class="glass-card p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-slate-50">ğŸ¤– AI æ¨¡å‹åå¥½</h3>
                                <span class="text-[11px] text-slate-500">é¸æ“‡ä½ å–œæ­¡çš„ AI åŠ©æ‰‹æ¨¡å‹</span>
                </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-xs font-medium text-slate-300 mb-2">é¸æ“‡ AI æ¨¡å‹</label>
                                    <select 
                                        id="user-ai-model-selector" 
                                        class="w-full input-base"
                                        style="color: #111827;"
                                        onchange="handleAIModelChange(event)"
                                    >
                                        <option value="glm-4-flash-250414">GLM-4-Flash (æ™ºè­œAI) - å¿«é€ŸéŸ¿æ‡‰ï¼Œé©åˆä¸€èˆ¬å•ç­”</option>
                                        <option value="deepseek-ai/DeepSeek-V3.2">DeepSeek-V3.2 - å¼·å¤§çš„æ¨ç†èƒ½åŠ›</option>
                                        <option value="Qwen/Qwen2.5-Coder-32B-Instruct">Qwen2.5-Coder-32B - å°ˆç‚ºä»£ç¢¼ä»»å‹™å„ªåŒ–</option>
                                    </select>
                </div>
                                <div class="text-[11px] text-slate-400">
                                    <p>ğŸ’¡ æç¤ºï¼šä½ å¯ä»¥åœ¨ä»»æ„é é¢çš„ AI åŠ©æ‰‹å´é‚Šæ¬„ä¸­éš¨æ™‚åˆ‡æ›æ¨¡å‹ï¼Œè¨­ç½®æœƒè‡ªå‹•ä¿å­˜ã€‚</p>
                </div>
                </div>
                        </section>
                    </section>
        </div>
    </div>
        </div>
    </main>

    <!-- é€šçŸ¥æ¢ -->
    <div id="user-toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 px-4 py-2 rounded-full bg-slate-900/90 border border-slate-700 text-xs text-slate-100 shadow-lg shadow-slate-900/80 hidden z-50"></div>

    <!-- ç”¨æˆ¶ API & ä¸»é‚è¼¯ -->
    <script src="user-api.js"></script>
    <script>
        let currentUser = null;
        let userData = {};

        function showToast(message, type = 'info') {
            const toast = document.getElementById('user-toast');
            if (!toast) return;
            toast.textContent = message;
            toast.classList.remove('hidden');
            toast.classList.remove('border-sky-500/60', 'border-emerald-500/60', 'border-rose-500/60');
            if (type === 'success') toast.classList.add('border-emerald-500/60');
            else if (type === 'error') toast.classList.add('border-rose-500/60');
            else toast.classList.add('border-sky-500/60');
            setTimeout(() => toast.classList.add('hidden'), 2600);
        }

        async function initializeUserCenter() {
            if (UserAPI && UserAPI.isLoggedIn()) {
                currentUser = UserAPI.getCurrentUsername();
                await loadUserInfo();
                showLoggedInView();
            } else {
                showNotLoggedInView();
            }
        }

        function showLoggedInView() {
            // éš±è—æœªç™»å…¥æç¤º
            document.getElementById('not-logged-in-view').classList.add('hidden');
            // é¡¯ç¤ºå·²ç™»å…¥è¦–åœ–
            document.getElementById('logged-in-view').classList.remove('hidden');
            // éš±è—ç™»å…¥/è¨»å†Šæ¨¡å¡Š
            const authSection = document.getElementById('auth-section');
            if (authSection) {
                authSection.classList.add('hidden');
            }
            // èª¿æ•´å€‹äººè³‡æ–™å€åŸŸä½”æ»¿æ•´è¡Œ
            const profileSection = document.getElementById('profile-section');
            if (profileSection) {
                profileSection.classList.remove('lg:col-span-2');
                profileSection.classList.add('lg:col-span-3');
            }
        }

        function showNotLoggedInView() {
            // é¡¯ç¤ºæœªç™»å…¥æç¤º
            document.getElementById('not-logged-in-view').classList.remove('hidden');
            // éš±è—å·²ç™»å…¥è¦–åœ–
            document.getElementById('logged-in-view').classList.add('hidden');
            // é¡¯ç¤ºç™»å…¥/è¨»å†Šæ¨¡å¡Š
            const authSection = document.getElementById('auth-section');
            if (authSection) {
                authSection.classList.remove('hidden');
            }
            // æ¢å¾©å€‹äººè³‡æ–™å€åŸŸçš„åŸå§‹å¯¬åº¦
            const profileSection = document.getElementById('profile-section');
            if (profileSection) {
                profileSection.classList.remove('lg:col-span-3');
                profileSection.classList.add('lg:col-span-2');
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;
            
            if (!username || !password) {
                showToast('è«‹è¼¸å…¥ç”¨æˆ¶å / é›»éƒµå’Œå¯†ç¢¼', 'error');
                return;
            }

            try {
                const result = await UserAPI.login(username, password);
                if (result.success) {
                    currentUser = result.username;
                    await loadUserInfo();
                showLoggedInView();
                    showToast('ç™»å…¥æˆåŠŸ', 'success');
                    document.getElementById('login-form').reset();
            } else {
                    showToast(result.error || 'ç™»å…¥å¤±æ•—', 'error');
                }
            } catch (e) {
                console.error(e);
                showToast('ç™»å…¥éç¨‹ç™¼ç”ŸéŒ¯èª¤', 'error');
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            const username = document.getElementById('register-username').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            
            if (!username || !email || !password) {
                showToast('è«‹å¡«å¯«æ‰€æœ‰è¨»å†Šæ¬„ä½', 'error');
                return;
            }
            if (password.length < 6) {
                showToast('å¯†ç¢¼é•·åº¦è‡³å°‘ 6 å€‹å­—ç¬¦', 'error');
                return;
            }
            if (password !== confirmPassword) {
                showToast('å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´', 'error');
                return;
            }
            
            try {
                const result = await UserAPI.register(username, email, password);
                if (result.success) {
                    showToast('è¨»å†ŠæˆåŠŸï¼Œè«‹ä½¿ç”¨æ–°å¸³è™Ÿç™»å…¥', 'success');
                    document.getElementById('register-form').reset();
                } else {
                    showToast(result.error || 'è¨»å†Šå¤±æ•—', 'error');
                }
            } catch (e) {
                console.error(e);
                showToast('è¨»å†Šéç¨‹ç™¼ç”ŸéŒ¯èª¤', 'error');
            }
        }

        async function handleLogout() {
            try {
                await UserAPI.logout();
            } catch (e) {
                console.error(e);
            }
            currentUser = null;
            showNotLoggedInView();
            showToast('å·²ç™»å‡º', 'success');
        }

        async function loadUserInfo() {
            try {
                const profileRes = await UserAPI.getProfile();
                const progressRes = await UserAPI.getProgress();

                if (profileRes.success && profileRes.profile) {
                    const p = profileRes.profile;
                    document.getElementById('profile-username').textContent = p.username || currentUser;
                    document.getElementById('profile-email').textContent = p.email || 'æœªè¨­ç½®';
                    const initial = (p.full_name || p.username || currentUser || 'U').charAt(0).toUpperCase();
                    document.getElementById('profile-avatar-initial').textContent = initial;
                    document.getElementById('profile-full-name').value = p.full_name || '';
                    document.getElementById('profile-location').value = p.location || '';
                    document.getElementById('profile-phone').value = p.phone || '';
                    document.getElementById('profile-birth-date').value = p.birth_date || '';
                    document.getElementById('profile-bio').value = p.bio || '';
                    document.getElementById('profile-join-date').textContent = 'åŠ å…¥æ—¥æœŸï¼š' + (p.created_at || '--');
                }

                if (progressRes.success && progressRes.progress) {
                    const prog = progressRes.progress;
                    const completed = (prog.completed_exercises || []).length;
                    const studyTime = prog.study_time || 0;
                    const totalScore = prog.total_score || 0;
                    const level = prog.level || 1;

                    document.getElementById('profile-completed').textContent = completed;
                    document.getElementById('profile-study-time').textContent = `${studyTime} åˆ†é˜`;
                    document.getElementById('profile-study-hours').textContent = `ç´„ ${(studyTime / 60).toFixed(1)} å°æ™‚`;
                    document.getElementById('profile-total-score').textContent = totalScore;
                    document.getElementById('profile-level-badge').textContent = `Lv.${level}`;

                    const percent = Math.max(5, Math.min(100, completed)); // ç°¡å–®ä»¥å®Œæˆé¡Œæ•¸æ˜ å°„
                    document.getElementById('profile-progress-bar').style.width = `${percent}%`;
                    document.getElementById('profile-badge-info').textContent =
                        totalScore >= 1000 ? 'ä½ å·²æ˜¯ SQL å°é«˜æ‰‹ï¼Œç¹¼çºŒæŒ‘æˆ°æ›´é›£é¡Œç›®ï¼' :
                        totalScore >= 500 ? 'è¡¨ç¾å¾ˆå¥½ï¼Œå†å¤šå®Œæˆå¹¾é¡Œå³å¯å‡ç´šæˆå°±ç« ã€‚' :
                        'å®Œæˆæ›´å¤šé¡Œç›®ä»¥è§£é–æˆå°±';
                }
                
                // è¼‰å…¥ AI æ¨¡å‹é¸æ“‡
                await loadAIModelPreference();
            } catch (e) {
                console.error('è¼‰å…¥ç”¨æˆ¶è³‡æ–™å¤±æ•—:', e);
            }
        }
        
        async function loadAIModelPreference() {
            try {
                if (typeof UserAPI !== 'undefined' && UserAPI.isLoggedIn()) {
                    const result = await UserAPI.getAIModel();
                    if (result.success && result.model) {
                        const selector = document.getElementById('user-ai-model-selector');
                        if (selector) {
                            selector.value = result.model;
                        }
                    }
                } else if (typeof getSelectedModel !== 'undefined') {
                    // å¦‚æœæœªç™»éŒ„ï¼Œå¾ localStorage è®€å–
                    const model = await getSelectedModel();
                    const selector = document.getElementById('user-ai-model-selector');
                    if (selector) {
                        selector.value = model;
                    }
                }
            } catch (e) {
                console.error('è¼‰å…¥ AI æ¨¡å‹åå¥½å¤±æ•—:', e);
            }
        }
        
        async function handleAIModelChange(event) {
            const selectedModel = event.target.value;
            try {
                if (typeof setSelectedModel !== 'undefined') {
                    const success = await setSelectedModel(selectedModel);
                    if (success) {
                        showToast('AI æ¨¡å‹åå¥½å·²æ›´æ–°', 'success');
                        // æ¸…é™¤ç·©å­˜ï¼Œç¢ºä¿ä¸‹æ¬¡ä½¿ç”¨æ–°æ¨¡å‹
                        if (typeof clearModelCache !== 'undefined') {
                            clearModelCache();
                        }
                    } else {
                        showToast('æ›´æ–° AI æ¨¡å‹åå¥½å¤±æ•—', 'error');
                        // æ¢å¾©åŸä¾†çš„é¸æ“‡
                        await loadAIModelPreference();
                    }
                } else {
                    showToast('AI æ¨¡å‹åŠŸèƒ½æœªåŠ è¼‰ï¼Œè«‹åˆ·æ–°é é¢', 'error');
                }
            } catch (e) {
                console.error('æ›´æ–° AI æ¨¡å‹åå¥½å¤±æ•—:', e);
                showToast('æ›´æ–° AI æ¨¡å‹åå¥½å¤±æ•—', 'error');
                await loadAIModelPreference();
            }
        }

        async function handleProfileUpdate(event) {
            event.preventDefault();
            if (!currentUser) {
                showToast('è«‹å…ˆç™»å…¥', 'error');
                return;
            }
            const payload = {
                full_name: document.getElementById('profile-full-name').value.trim(),
                location: document.getElementById('profile-location').value.trim(),
                phone: document.getElementById('profile-phone').value.trim(),
                birth_date: document.getElementById('profile-birth-date').value,
                bio: document.getElementById('profile-bio').value.trim()
            };
            try {
                const res = await UserAPI.updateProfile(payload);
                if (res.success) {
                    showToast('å€‹äººè³‡æ–™å·²æ›´æ–°', 'success');
                    await loadUserInfo();
                } else {
                    showToast(res.error || 'æ›´æ–°å¤±æ•—', 'error');
                }
            } catch (e) {
                console.error(e);
                showToast('æ›´æ–°éç¨‹ç™¼ç”ŸéŒ¯èª¤', 'error');
            }
        }

        async function syncProgress() {
            // ç›®å‰é€²åº¦å·²è‡ªå‹•åŒæ­¥è‡³ SQLiteï¼Œé€™è£¡å¯æ“´å±•ç‚ºå¾ç€è¦½å™¨ localStorage èˆŠè³‡æ–™ä¸Šå‚³
            showToast('å­¸ç¿’é€²åº¦å·²èˆ‡ä¼ºæœå™¨ä¿æŒåŒæ­¥', 'info');
        }

        document.addEventListener('DOMContentLoaded', initializeUserCenter);
    </script>

    <!-- å…¨ç«™ AI åŠ©æ‰‹ -->
    <script src="ai-service.js"></script>
    <script src="ai-assistant.js"></script>

    <!-- é è…³ -->
    <footer class="bg-slate-950/80 border-t border-slate-800 py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 text-sm">
                <div>
                    <h4 class="text-slate-100 font-semibold mb-3" data-i18n-key="footer.about">é—œæ–¼æˆ‘å€‘</h4>
                    <a href="https://github.com/vvvjb18-lab/dse-sql-python-camp/blob/main/docs/about.md" target="_blank" class="text-sky-400 hover:text-sky-300 block mb-2" data-i18n-key="footer.about">é—œæ–¼æˆ‘å€‘</a>
                    <a href="https://github.com/vvvjb18-lab/dse-sql-python-camp" target="_blank" class="text-sky-400 hover:text-sky-300 block" data-i18n-key="footer.github">é–‹æºå°ˆæ¡ˆ</a>
                </div>
                <div>
                    <h4 class="text-slate-100 font-semibold mb-3" data-i18n-key="footer.legal">æ³•å¾‹è³‡è¨Š</h4>
                    <a href="https://github.com/vvvjb18-lab/dse-sql-python-camp/blob/main/docs/terms.md" target="_blank" class="text-slate-400 hover:text-sky-400 block mb-2" data-i18n-key="footer.terms">ä½¿ç”¨æ¢æ¬¾</a>
                    <a href="https://github.com/vvvjb18-lab/dse-sql-python-camp/blob/main/docs/privacy.md" target="_blank" class="text-slate-400 hover:text-sky-400 block" data-i18n-key="footer.privacy">éš±ç§æ”¿ç­–</a>
                </div>
                <div>
                    <h4 class="text-slate-100 font-semibold mb-3" data-i18n-key="footer.contact">è¯çµ¡æˆ‘å€‘</h4>
                    <a href="https://github.com/vvvjb18-lab/dse-sql-python-camp/blob/main/docs/contact.md" target="_blank" class="text-slate-400 hover:text-sky-400 block mb-2" data-i18n-key="footer.contact">è¯çµ¡æˆ‘å€‘</a>
                    <a href="mailto:yivh5723@gmail.com" class="text-slate-400 hover:text-sky-400 block">yivh5723@gmail.com</a>
                </div>
                <div>
                    <h4 class="text-slate-100 font-semibold mb-3">é€£çµ</h4>
                    <a href="https://icthelper.duckdns.org" target="_blank" class="text-slate-400 hover:text-sky-400 block mb-2">ç·šä¸Šæ¼”ç¤º</a>
                    <a href="https://github.com/vvvjb18-lab/dse-sql-python-camp" target="_blank" class="text-slate-400 hover:text-sky-400 block">GitHub</a>
                </div>
            </div>
            <div class="mt-6 pt-6 border-t border-slate-700 text-center">
                <p class="text-slate-400 text-xs" data-i18n-key="footer.copyright">Â© 2025 DSE SQL & Python è¨“ç·´ç‡Ÿ</p>
            </div>
        </div>
    </footer>
</body>
</html>

